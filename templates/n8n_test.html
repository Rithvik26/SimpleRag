{% extends "base.html" %}

{% block title %}n8n Integration Test{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>n8n Automation Test</h2>
    <p class="text-muted">Test automated document indexing via n8n webhook</p>
    
    <div class="card">
        <div class="card-body">
            <form id="n8nTestForm">
                <div class="mb-3">
                    <label class="form-label">Document URL</label>
                    <input type="text" class="form-control" id="fileUrl" 
                           value="https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf">
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Filename</label>
                    <input type="text" class="form-control" id="filename" value="test_doc.pdf">
                </div>
                
                <div class="mb-3">
                    <label class="form-label">RAG Mode</label>
                    <select class="form-control" id="ragMode">
                        <option value="normal">Normal RAG</option>
                        <option value="graph">Graph RAG</option>
                        <option value="neo4j">Neo4j Only</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary">Trigger n8n Workflow</button>
            </form>
            
            <div id="result" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
document.getElementById('n8nTestForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<div class="alert alert-info">Triggering n8n workflow...</div>';
    
    try {
        const response = await fetch('http://localhost:5678/webhook/document-upload', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                file_url: document.getElementById('fileUrl').value,
                filename: document.getElementById('filename').value,
                rag_mode: document.getElementById('ragMode').value
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            resultDiv.innerHTML = `
                <div class="alert alert-success">
                    <strong>Success!</strong><br>
                    File: ${data.filename}<br>
                    Mode: ${data.rag_mode}<br>
                    Chunks: ${data.chunks_created}
                </div>`;
        } else {
            resultDiv.innerHTML = `<div class="alert alert-danger">Error: ${data.error}</div>`;
        }
    } catch (error) {
        resultDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
    }
});
</script>
{% endblock %}